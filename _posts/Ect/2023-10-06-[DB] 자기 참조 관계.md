---
layout: single
title: "[DB] 자기 참조 관계"
excerpt: 
categories:
  - Ect
toc: ture
toc_sticky: true
---

<!-- 위는 머릿말임 아래부터 포스트 본문 -->

![Untitled](/assets/images/%5BDB%5D%20%E1%84%8C%E1%85%A1%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%A1%E1%86%B7%E1%84%8C%E1%85%A9%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20b9b0a3c7e6774f728f90587fd9daa5f5/Untitled.png)

테이블이 자기 자신을 참조하는 자기 참조 관계(self-referencing relationship)에 있을 때 주의해야 할 몇 가지 중요한 사항이 있습니다:

1. **순환 참조 방지**: 자기 참조에서는 특히 순환 참조(circular reference)가 발생하지 않도록 주의해야 합니다. 예를 들어, 어떤 레코드가 직접적이거나 간접적으로 자기 자신을 참조하는 상황을 방지해야 합니다.
2. **계층 구조 관리**: 자기 참조는 종종 계층적 데이터(예: 조직도, 카테고리 구조)를 표현하는 데 사용됩니다. 이러한 구조를 관리할 때는 계층을 순회하고 처리하는 데 필요한 복잡한 쿼리나 알고리즘이 필요할 수 있습니다.
3. **데이터 무결성 유지**: 삭제 또는 업데이트 연산 시, 참조 무결성(referential integrity)을 유지해야 합니다. 예를 들어, 부모 레코드가 삭제될 경우 자식 레코드에 어떤 영향을 미칠지 결정해야 합니다(예: 자식 레코드도 삭제, 부모 참조를 NULL로 설정 등).
4. **트리거와 제약 조건**: 자기 참조 구조에서는 트리거(trigger)나 제약 조건(constraint)을 사용하여 데이터 무결성을 강화할 수 있습니다. 예를 들어, 삭제된 레코드의 자식 레코드를 자동으로 처리하는 트리거를 구현할 수 있습니다.
5. **NULL 값 처리**: **`parent_no`** 필드는 최상위 레벨의 항목에서 NULL이 될 수 있습니다. 이러한 상황을 올바르게 처리하는 것이 중요합니다.
6. **성능 고려**: 대규모 데이터셋에서 계층적 쿼리를 수행할 때 성능 문제가 발생할 수 있습니다. 적절한 인덱싱과 쿼리 최적화를 고려해야 합니다.
7. **애플리케이션 로직**: 애플리케이션 측에서도 자기 참조 데이터를 처리하는 데 필요한 로직을 구현해야 합니다. 특히 사용자 인터페이스에서 이러한 관계를 명확하게 표현하는 것이 중요할 수 있습니다.

자기 참조 관계를 사용할 때는 이러한 사항들을 신중하게 고려하여 데이터 무결성, 사용성, 그리고 성능 문제를 미리 방지하는 것이 중요합니다.

### 주로 사용되는 곳

자기 참조 관계(self-referencing relationship)는 데이터베이스 설계에서 특정 엔터티가 자신과 같은 유형의 다른 엔터티를 참조할 때 사용됩니다. 이러한 관계는 주로 계층적이거나 그래프 구조의 데이터를 모델링할 때 유용하며, 다음과 같은 경우에 자주 사용됩니다:

1. **조직도**: 회사나 기타 조직의 조직도에서, 각 직원 또는 부서가 상위 직원 또는 부서를 참조할 수 있습니다. 예를 들어, 각 직원의 레코드가 그들의 관리자의 레코드를 참조할 수 있습니다.
2. **카테고리 구조**: 온라인 상점이나 콘텐츠 관리 시스템에서 사용되는 계층적 카테고리 시스템에서, 각 카테고리가 상위 카테고리를 참조할 수 있습니다. 예를 들어, "전자제품" 카테고리 아래에 "휴대폰", "컴퓨터" 등의 하위 카테고리가 위치할 수 있습니다.
3. **트리 구조 데이터**: 일반적인 트리 구조에서, 각 노드는 부모 노드를 참조할 수 있습니다. 이는 파일 시스템의 디렉토리 구조, 코멘트 시스템의 대댓글 구조 등 다양한 형태로 응용될 수 있습니다.
4. **멤버십 계층**: 멤버십 프로그램이나 조직에서, 상위 멤버가 하위 멤버를 가질 수 있으며, 이러한 관계는 멀티 레벨 마케팅(MLM)이나 추천 프로그램에 사용됩니다.
5. **부품과 조립품**: 제조업에서, 복잡한 제품은 여러 하위 부품으로 구성될 수 있으며, 이러한 부품들 또한 다른 부품들로 구성될 수 있습니다. 이러한 경우, 각 부품은 상위 조립품을 참조하게 됩니다.

자기 참조 관계는 데이터를 계층적으로 구조화하는 데 매우 효과적이지만, 복잡한 쿼리와 데이터 관리가 필요할 수 있으므로 신중한 설계가 요구됩니다.